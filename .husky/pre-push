# Pre-push hook to run linting and Cypress tests with Firebase emulator
# This hook will prevent pushing if linting or tests fail

echo "Running linting before push..."
echo ""

# Run linting
npm run lint

# Capture the exit code
LINT_EXIT_CODE=$?

if [ $LINT_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "❌ Linting failed! Push aborted."
    echo "Fix the linting errors before pushing."
    exit 1
fi

echo ""
echo "✅ Linting passed!"
echo ""
echo "Running Cypress tests with Firebase emulator before push..."
echo ""

# Run the tests
npm run cy:run:emulator

# Capture the exit code
TEST_EXIT_CODE=$?

if [ $TEST_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "❌ Tests failed! Push aborted."
    echo "Fix the failing tests before pushing."
    exit 1
fi

echo ""
echo "✅ All linting and tests passed! Proceeding with push..."
exit 0

